---
title: "Personal Project Quarto"
author: "Jason Ficorilli"
format:
  pdf:
    geometry: 
      - top=30mm
      - left=30mm
editor: visual
bibliography: references.bib
csl: apa7.csl
---

```{r}
#| echo: false
#| warning: false

#Loading packages
library(tidyverse)
```

```{r}
#| echo: false

#Load main data set
health_df <- read.csv(url("https://raw.githubusercontent.com/Stat184-Fall2024/Sec1_FP_DanielLiu_JasonFicorilli/refs/heads/main/data/global_health.csv"))


#Load global regions data set
regions_df <- read.csv(url("https://raw.githubusercontent.com/Stat184-Fall2024/Sec1_FP_DanielLiu_JasonFicorilli/refs/heads/main/data/UNSD_codes.csv"))


#Cleaning regions data
regions_df <- regions_df %>%
  select(c(ISO.alpha3.Code, Region.Name, Sub.region.Name)) #remove extraneous data

#Left join of main health df and regions by ISO code
health_df <- left_join(
  x = health_df,
  y = regions_df,
  by = join_by(Country_Code == ISO.alpha3.Code)
)

#Select all columns from 2012-2021 table except year and country code
country_avg_df <- health_df %>% 
  select(!c(Year, Country_Code)) #Remove year and country code columns

#Create data frame of averaged columns
country_avg_df <- aggregate( #aggregate columns to be averages from 2012-2021
  x = country_avg_df[, 2:27],
  by = list(country_avg_df$Country),
  FUN = mean
) %>%
  rename("Country" = "Group.1")
```

## Part Two: Evaluating the Temporal Characteristics of Countries with High and Low Life Expectancies

After considering the relationship between life expectancy and safe water access across all available countries within the data set, it is reasonable to question what attributes separate countries with high and low life expectancy. With this in mind, our focus can narrow to isolating small subsets of countries with vastly differing life expectancy rates and comparing different characteristics about their treatment of healthcare over time.

### Highest and Lowest Life Expectancy Countries

In order to identify countries to investigate further, we demonstrate the top five countries with the highest and lowest average life expectancy measures from 2012-2021, as shown in each respective bar chart.

```{r}
#| label: fig-barcharts_average_le
#| fig-cap: "Top Five Countries with the Highest and Lowest Average Life Expectancy Measures from 2012-2021"
#| fig-subcap:
#|   - "Top Five Highest Average Life Expectancy Countries"
#|   - "Top Five Lowest Average Life Expectancy Countries" 
#| layout-ncol: 2
#| column: page
#| echo: false

#Horizontal bar chart for the five lowest average life expectancy countries
ggplot(
  data = country_avg_df %>% arrange(Life_Expectancy) %>% head(5), #get top 5 countries
  mapping = aes(
    x = Life_Expectancy,
    y = reorder(Country, -Life_Expectancy)) #reorder bars to be descending
) + 
  geom_col(fill="darkred")+
  geom_text(aes(label = signif(Life_Expectancy, 4)), nudge_x = 4) + 
  #add respective values (4 sig figs) next to bars
  labs(
    x = "Average Life Expectancy (in Years)",
    y = "Country"
  ) +
  theme_classic()
  

#Horizontal bar chart for the five highest average life expectancy countries
ggplot(
  data = country_avg_df %>% arrange(desc(Life_Expectancy)) %>% head(5), #get top 5
  mapping = aes(
    x = Life_Expectancy,
    y = reorder(Country, Life_Expectancy)) #reorder bars to be descending
) + 
  geom_col(fill="darkgreen")+
  geom_text(aes(label = signif(Life_Expectancy, 4)), nudge_x = 5) + 
  #add respective values (4 sig figs) next to bars
  labs(
    x = "Average Life Expectancy (in Years)",
    y = "Country"
  ) +
  theme_classic()
```

As captured in the figure, the differences in the highest and lowest life expectancy measures is stark. Over the period of time from 2012-2021, a person would have been expected to live an average of 32 years longer as a Japanese resident compared to having lived in Lesotho. Geographical differences are also apparent: the top five countries with the lowest average life expectancy are in Africa, while the top five highest average life expectancy are in Asia and Europe. To further explore the differences between these types of countries, the three highest (**Japan**, **Switzerland**, and **Spain**) and three lowest (**Lesotho**, **Chad**, and **Nigeria**) average life expectancy countries will be primarily evaluated.

Considering such differences in average life expectancy from 2012-2021, the year-by-year basis of each country's life expectancy can be explored further, as shown in the figure below.

```{r}
#| label: fig-le_linecharts
#| fig-cap: "Life Expectancy Measures for Select Countries from 2012-2021"
#| fig-subcap:
#|   - "Change in Life Expectancy for Chad, Lesotho, and Nigeria"
#|   - "Change in Life Expectancy for Japan, Spain, and Switzerland" 
#| layout-ncol: 2
#| column: page
#| echo: false

#Life expectancy line chart for low 3 countries over time
ggplot(
  data = health_df %>% filter(Country=="Nigeria" | Country=="Lesotho" | Country =="Chad"),
  mapping = aes( #select dimensions to plot
    x = Year,
    y = Life_Expectancy,
    color = Country
  )
) +
  geom_point()+
  geom_line()+
  labs( #select labels for plot
    x = "Year",
    y = "Life Expectancy (in years)",
    color = "Country"
  ) +
  theme_classic() #change theme (remove grid lines)
  

#Life expectancy line chart for high 3 countries over time
ggplot(
  data = health_df %>% filter(Country=="Japan" | Country=="Spain" | Country =="Switzerland"),
  mapping = aes( #select dimensions to plot
    x = Year,
    y = Life_Expectancy,
    color = Country
  )
) +
  geom_point()+
  geom_line()+
  labs( #select labels for plot
    x = "Year",
    y = "Life Expectancy (in years)",
    color = "Country",
  ) +
  theme_classic() #change theme (remove grid lines)
```

The general life expectancy changes for each country from 2012-2021 reveal both similarities and differences between countries with high and low measures during that time. The three countries with lower life expectancy (Chad, Lesotho, Nigeria) all exhibited similar upward growth from 2012-2020, with Lesotho eclipsing the other countries in 2016 and adding over 5 years to its overall life expectancy. Although all three African countries showed consistent growth, Spain, Switzerland, and Japan were not as similar. While Japan held a consistent increase in life expectancy, both Spain and Switzerland saw decreases from 2014-2015 and, most notably from 2019-2020.

Although each country's trends were generally upward over time, a notable similarity was a decrease in life expectancy across every country within a part of the time period 2019-2021. This is likely the result of the COVID-19 global pandemic, which contributed to an estimated 18.2 million global deaths from 2020-2021.[^1] Interestingly, while Japan, Chad, Nigeria, and Lesotho all saw decreases in life expectancy from 2020-2021, Spain and Switzerland had considerable increases. Further, among the countries that did exhibit a loss during this time, Lesotho decreased the largest from 2020-2021, losing 1.63 years, while Spain lost 1.1 years from 2019-2020. The similarities and differences in life expectancy among these countries are further exemplified when compared on the basis of sex.

[^1]: [@wang2022]

```{r}
#| label: fig-le_linecharts_sex
#| fig-cap: "Life Expectancy Measures for Select Countries from 2012-2021 by Sex"
#| fig-subcap:
#|   - "Change in Life Expectancy for Chad, Lesotho, and Nigeria"
#|   - "Change in Life Expectancy for Japan, Spain, and Switzerland" 
#| layout-ncol: 2
#| column: page
#| echo: false

# Life expectancy line chart for low 3 countries, split on sex
ggplot(
  data = health_df %>% 
    filter(Country=="Nigeria" | Country=="Lesotho" | Country =="Chad") %>%
    select(Country, Year, Life_Expectancy_Male, Life_Expectancy_Female) %>%
    rename("Male" = "Life_Expectancy_Male") %>%
    rename("Female" = "Life_Expectancy_Female") %>%
    pivot_longer(
      cols = c("Male", "Female"),
      names_to = "Sex",
      values_to = "Life_Expectancy"
    ),
  mapping = aes( #select dimensions to plot
    x = Year,
    y = Life_Expectancy,
    color = Country
  )
) +
  geom_point()+
  geom_line(aes( #creating different line types based 'Sex'
    linetype = Sex
  ))+
  labs( #select labels for plot
    x = "Year",
    y = "Life Expectancy (in years)",
    color = "Country"
  ) +
  theme_classic() #change theme (remove grid lines)
  

#Life expectancy line chart for high 3 countries over time
ggplot(
  data = health_df %>% 
    filter(Country=="Japan" | Country=="Spain" | Country =="Switzerland") %>%
    select(Country, Year, Life_Expectancy_Male, Life_Expectancy_Female) %>%
    rename("Male" = "Life_Expectancy_Male") %>%
    rename("Female" = "Life_Expectancy_Female") %>%
    pivot_longer(
      cols = c("Male", "Female"),
      names_to = "Sex",
      values_to = "Life_Expectancy"
    ),
  mapping = aes( #select dimensions to plot
    x = Year,
    y = Life_Expectancy,
    color = Country
  )
) +
  geom_point()+
  geom_line(aes( #creating different line types based 'Sex'
    linetype = Sex
  ))+
  labs( #select labels for plot
    x = "Year",
    y = "Life Expectancy (in years)",
    color = "Country"
  ) +
  theme_classic() #change theme (remove grid lines)
```

The sex-based visuals display differing characteristics from the general life expectancy trends. Firstly, while most countries have had a higher female life expectancy of at least three years compared to the male rate throughout this time, Nigeria's life expectancy was considerably close for both men and women, with nearly identical values for several years. Further, of the European and Asian countries, women were expected to live nearly four years longer than men on average. These trends show that, while the magnitude of life expectancy for the three African countries and three European/Asian countries were vastly different, these regions all exhibited some similarities in the recent developments of their life expectancy.

After evaluating the temporal elements of the six countries' life expectancy values, the possible attributing factors to these changes can be addressed. While many factors influence the life expectancy measure for a country, several of which are beyond the scope of this project, the global health data set provides additional characteristics recorded over the period from 2012-2021 that further illustrate the differences between these countries.

### Differences in Population and Healthcare Expenditure

When looking at why a country might have experienced changes in the expected lifetime of their residents, it is important to consider the demographic and economic factors enabling a country to improve its population's health. Although two countries might have similar life expectancy values, vastly different government support systems and national finances could underlie their capabilities to perform effective public health initiatives. These comparisons provide necessary insight for evaluating how multiple countries have observed fluctuation in resident health over time. Firstly, we will discuss the differences of population and GDP between the six countries considered thus far.

```{r}
#| label: fig-barcharts_population_GDP_capita
#| fig-cap: "Average Total Population and Gross Domestic Product per Capita for Chad, Japan, Lesotho, Nigeria, Spain, and Switzerland from 2012-2021"
#| fig-subcap:
#|   - "Average Total Population"
#|   - "Average GDP per Capita" 
#| layout-ncol: 2
#| column: page
#| echo: false

#Vertical bar chart for average total population from 2012-2021
ggplot(
  data = country_avg_df %>% filter(Country %in% c("Chad", "Lesotho", "Nigeria", "Japan", "Spain", "Switzerland")),
  mapping = aes(
    x = reorder(Country, -Total_Population), #reorder bars to be descending from highest to lowest
    y = Total_Population)
) + 
  geom_col(fill="darkblue")+
  geom_text(aes(label = round(Total_Population)), nudge_y = 10000000) + #add respective values next to bars
  labs(
    x = "Country",
    y = "Average Total Population (to Nearest Person)"
  ) +
  theme_classic()

#Vertical bar chart for average GDP per capita from 2012-2021
ggplot(
  data = country_avg_df %>% filter(Country %in% c("Chad", "Lesotho", "Nigeria", "Japan", "Spain", "Switzerland")),
  mapping = aes(
    x = reorder(Country, -GDP_Per_Capita),
    y = GDP_Per_Capita) #reorder bars to be descending from highest to lowest
) + 
  geom_col(fill="gold")+
  geom_text(aes(label = round(GDP_Per_Capita, 2)), nudge_y = 3000) + #add respective values next to bars
  labs(
    x = "Country",
    y = "Average GDP per Capita (USD/Person)") +
  theme_classic()
```

The visuals of GDP and population size set the context for considering the life expectancy measures for each country. As shown in the average total population bar chart, Nigeria had a considerably larger population than all the other countries, with Switzerland having the second lowest followed by Lesotho. However, Switzerland had more than double the average GDP per capita than Japan and over 19 times more than the lowest three life expectancy countries combined. Further, Spain had over six times the total average GDP per capita of the three African countries, with Chad having only \$784.81 per person on average from 2012-2021.

Although national wealth is not the sole factor determining how long a country's residents are expected to live, it can represent a country's ability to provide adequate expenditure and government support for the healthcare needs of its population. In particular, it can reflect the financial support available for a country to combat serious diseases or mitigate air pollution, both of which could significantly decrease a country's life expectancy if widespread. This leads us to consider the comparison of each country's healthcare expenditure over time.

```{r}
#| label: fig-le_linecharts_Healthcare_le_low
#| fig-cap: "Healthcare Expenditures per Gross Domestic Product and Life Expectancy from 2012-2021 for Chad, Lesotho, and Nigeria"
#| fig-subcap:
#|   - "Healthcare Expenditures per GDP"
#|   - "Change in Life Expectancy"
#| layout-ncol: 2
#| column: page
#| echo: false

#Sanitary Expense per GDP line chart - low 3
ggplot(
  data = health_df %>% filter(Country %in% c("Chad", "Lesotho", "Nigeria")),
  mapping = aes( #select dimensions to plot
    x = Year,
    y = Sanitary_Expense_Per_GDP,
    color = Country
  )
) +
  geom_point()+
  geom_line()+
  labs( #select labels for plot
    x = "Year",
    y = "Healthcare Expense per GDP (Percentage)",
    color = "Country"
  ) +
  theme_classic() #change theme (remove grid lines)


#Life expectancy line chart for low 3 countries over time
ggplot(
  data = health_df %>% filter(Country=="Nigeria" | Country=="Lesotho" | Country =="Chad"),
  mapping = aes( #select dimensions to plot
    x = Year,
    y = Life_Expectancy,
    color = Country
  )
) +
  geom_point()+
  geom_line()+
  labs( #select labels for plot
    x = "Year",
    y = "Life Expectancy (in years)",
    color = "Country"
  ) +
  theme_classic() #change theme (remove grid lines)
```

```{r}
#| label: fig-le_linecharts_Healthcare_le_high
#| fig-cap: "Healthcare Expenditures per Gross Domestic Product and Life Expectancy from 2012-2021 for Japan, Spain, and Switzerland"
#| fig-subcap:
#|   - "Healthcare Expenditures per GDP"
#|   - "Change in Life Expectancy"
#| layout-ncol: 2
#| column: page
#| echo: false

#Sanitary Expense per GDP line chart - high 3
ggplot(
  data = health_df %>% filter(Country %in% c("Japan", "Spain", "Switzerland")),
  mapping = aes( #select dimensions to plot
    x = Year,
    y = Sanitary_Expense_Per_GDP,
    color = Country
  )
) +
  geom_point()+
  geom_line()+
  labs( #select labels for plot
    x = "Year",
    y = "Healthcare Expense per GDP (Percentage)",
    color = "Country"
  ) +
  theme_classic() #change theme (remove grid lines)


#Life expectancy line chart for high 3 countries over time
ggplot(
  data = health_df %>% filter(Country=="Japan" | Country=="Spain" | Country =="Switzerland"),
  mapping = aes( #select dimensions to plot
    x = Year,
    y = Life_Expectancy,
    color = Country
  )
) +
  geom_point()+
  geom_line()+
  labs( #select labels for plot
    x = "Year",
    y = "Life Expectancy (in years)",
    color = "Country"
  ) +
  theme_classic() #change theme (remove grid lines)
```

The direct comparison of the countries' healthcare expenditure to life expectancy changes reveals conflicting characteristics about the efficacy of large national healthcare spending. Firstly, when observing the three African countries, Lesotho's large expenditure percentage of its GDP towards healthcare seems to be a worthwhile investment as its life expectancy has risen considerably over the years relative to similar average expectancy countries. However, when observing the European and Asian countries, Spain's very low expenditure relative to Switzerland and Japan while maintaining similar life expectancy may suggest the opposite.

Either way, a notable observation is the magnitude of the expenditure percentages of GDP across the countries. Yearly, Chad and Nigeria combined spent less than Lesotho on healthcare: roughly only 3-4% each. This is less than double the rate of Lesotho, Japan, and Switzerland respectively, which may reflect the countries' slowly increasing life expectancy relative to Lesotho.

### Differences in Air Pollution and Safe Water Access

Although a country can spend significant finances relative to its GDP to improve its population's healthcare treatment, this expenditure must also combat sources that put its population at a health risk. To consider these possible factors, we observe patterns of air pollution exposure and safe water access relative to life expectancy for the six countries.

```{r}
#| label: fig-safe_water_access_linecharts
#| fig-cap: "Air Pollution Levels and Safe Water Access Percentage from 2012-2021 for Chad, Japan, Lesotho, Nigeria, Spain, and Switzerland"
#| fig-subcap:
#|   - "Change in Air Pollution Levels from 2012-2020"
#|   - "Change in Safe Water Access Percentage from 2012-2021" 
#| layout-ncol: 2
#| column: page
#| echo: false
#| warning: false

#Air Pollution Levels - all countries
ggplot(
  data = health_df %>% filter(Country %in% c("Chad", "Lesotho", "Nigeria", "Japan", "Spain", "Switzerland")),
  mapping = aes( #select dimensions to plot
    x = Year,
    y = Air_Pollution,
    color = Country
  )
) +
  geom_point()+
  geom_line()+
  labs( #select labels for plot
    x = "Year",
    y = "Air Pollution (micrograms per cubic meter)",
    color = "Country") +
  theme_classic() #change theme (remove grid lines)

#Safe Water Access Percentage - all countries
ggplot(
  data = health_df %>% filter(Country %in% c("Chad", "Lesotho", "Nigeria", "Japan", "Spain", "Switzerland")),
  mapping = aes( #select dimensions to plot
    x = Year,
    y = Safe_Water_Access_Percent,
    color = Country
  )
) +
  geom_point()+
  geom_line()+
  labs( #select labels for plot
    x = "Year",
    y = "Safe Water Access Percentage",
    color = "Country") +
  theme_classic() #change theme (remove grid lines)

```

These pollution and safe water access visuals reveal considerable insights into potential causes for the life expectancy discrepancies between the six countries. In the graphs, the three African countries have air pollution levels considerably higher than the European and Asian countries. Similarly, over a third of the population for each African country does not have safe access to water, while nearly 100% of the other countries do. These results highlight the major disparities in population quality of life between countries with high and low life expectancy. Although there are promising developments with increasing rates of safe water access and decreasing air pollution levels for Chad and Nigeria, the high magnitudes relative to a country like Lesotho likely remain influential factors in harming overall population life expectation.

```{r}
#| label: fig-safe_water_le_linechart_all
#| fig-cap: "Life Expectancy and Safe Water Access Percentage from 2012-2021 for Chad, Japan, Lesotho, Nigeria, Spain, and Switzerland"
#| fig-subcap:
#|   - "Chad, Lesotho, and Nigeria"
#|   - "Japan, Spain, and Switzerland"
#| column: page
#| layout-ncol: 2
#| echo: false

#Life expectancy and safe water access percentage line chart for low 3
ggplot(
  data = health_df %>% filter(Country %in% c("Chad", "Lesotho", "Nigeria")),
  mapping = aes( #select dimensions to plot
    x = Year,
    y = Life_Expectancy,
    color = Country
  )
) +
  geom_point(aes(size = Safe_Water_Access_Percent))+
  geom_line()+
  labs( #select labels for plot
    x = "Year",
    y = "Life Expectancy (in Years)",
    color = "Country",
    size = "Safe Water Access Percent"
  ) +
  theme_classic() #change theme (remove grid lines)

#Life expectancy and safe water access percentage line chart for high 3
ggplot(
  data = health_df %>% filter(Country %in% c("Japan", "Spain", "Switzerland")),
  mapping = aes( #select dimensions to plot
    x = Year,
    y = Life_Expectancy,
    color = Country
  )
) +
  geom_point(aes(size = Safe_Water_Access_Percent))+
  geom_line()+
  labs( #select labels for plot
    x = "Year",
    y = "Life Expectancy (in Years)",
    color = "Country",
    size = "Safe Water Access Percent"
  ) +
  theme_classic() #change theme (remove grid lines)
```

## Conclusion

Through this analysis, we have evaluated the different dimensions of global life expectancy and its relationship with safe water access. In part one, after preparing our data, we evaluated a possible relationship between a country's safe water access and its population life expectancy. Here, we found that, on average, life expectancy for a country tends to increase given an increase in safe water access percentage. In part two, we identified countries with high and low average life expectancy. Through analyzing the relationships between life expectancy and gender, healthcare expenditure, and air pollution levels, we identified the similarities and differences in such factors attributing to population health. In particular, we found that the subset of countries with the lowest average life expectancy (**Chad**, **Lesotho**, and **Nigeria**) had considerably higher levels of air pollution and less population access to safe water, which could be significantly influencing their countries' vastly lower life expectancy relative to the highest average countries (**Japan**, **Span**, and **Switzerland**).

Considering these results, it is important to consider if countries' healthcare expenditure truly impacts the improvement of overall health outcomes. For Chad and Nigeria in particular, their high air pollution levels and low safe water access amid small healthcare expenditure per GDP (relative to high average life expectancy countries) signals an important role. Further, Lesotho saw a considerable increase in its life expectancy over its period of spending roughly 10% of its GDP on healthcare. However, a causal relationship cannot be determined from this analysis alone and must be considered in the context of many more countries' observations.

## Code Appendix

```{r codeAppend, ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```

## References
